ğŸ“‹ è®¡åˆ’æ¦‚è¿°
æˆ‘ä¸ºä½ è®¾è®¡äº†ä¸€ä¸ªå¾ªåºæ¸è¿›çš„ 8 é˜¶æ®µå­¦ä¹ è·¯å¾„ï¼Œè®©ä½ è¾¹å­¦è¾¹åšï¼š
ğŸ¯ æ ¸å¿ƒç­–ç•¥
å…ˆ Web åæ¡Œé¢: ä»ç®€å•çš„ React + Express å¼€å§‹ï¼Œä»£ç å¯ä»¥å®Œå…¨å¤ç”¨åˆ°åæœŸçš„ Electron ç‰ˆæœ¬
æ¸è¿›å¼å­¦ä¹ : æ¯ä¸ªé˜¶æ®µä¸“æ³¨ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œé…åˆå­¦ä¹ é‡ç‚¹å’Œå‚è€ƒèµ„æº
å‚è€ƒ AionUI: å€Ÿé‰´å…¶ä¼˜ç§€çš„æ¶æ„è®¾è®¡ï¼Œä½†å¤§å¹…ç®€åŒ–å¤æ‚åº¦
ğŸ“š 8 ä¸ªå­¦ä¹ é˜¶æ®µ
ç¬¬ä¸€é˜¶æ®µ (1å‘¨): é¡¹ç›®æ­å»º + JWT è®¤è¯ â†’ å­¦ä¹  Node.js åŸºç¡€
ç¬¬äºŒé˜¶æ®µ (1å‘¨): è§’è‰²ç®¡ç†ç³»ç»Ÿ â†’ å­¦ä¹  CRUD å’Œè¡¨å•å¤„ç†
ç¬¬ä¸‰é˜¶æ®µ (1å‘¨): åŸºç¡€èŠå¤©ç•Œé¢ â†’ å­¦ä¹  React çŠ¶æ€ç®¡ç†
ç¬¬å››é˜¶æ®µ (1å‘¨): OpenAI API é›†æˆ â†’ å­¦ä¹ å¼‚æ­¥ç¼–ç¨‹å’Œ API è°ƒç”¨
ç¬¬äº”é˜¶æ®µ (1å‘¨): @æåŠåŠŸèƒ½ â†’ å­¦ä¹ æ–‡æœ¬è§£æå’Œæ­£åˆ™è¡¨è¾¾å¼
ç¬¬å…­é˜¶æ®µ (1å‘¨): ä¸Šä¸‹æ–‡ç®¡ç† â†’ å­¦ä¹ æ€§èƒ½ä¼˜åŒ–
ç¬¬ä¸ƒé˜¶æ®µ (1å‘¨): UI ä¼˜åŒ– â†’ å­¦ä¹ ç”¨æˆ·ä½“éªŒè®¾è®¡
ç¬¬å…«é˜¶æ®µ (å¯é€‰): æµå¼å“åº”ã€æ–‡ä»¶ä¸Šä¼ ç­‰é«˜çº§åŠŸèƒ½
ğŸ—ï¸ æŠ€æœ¯æ ˆé€‰æ‹©
ä¿ç•™ AionUI çš„ä¼˜ç‚¹:
React 19 + TypeScript
Arco Design (UI ç»„ä»¶åº“)
Express + SQLite
Context API (çŠ¶æ€ç®¡ç†)
ç®€åŒ–çš„éƒ¨åˆ†:
âŒ ä¸ç”¨ Electronï¼ˆå…ˆåš Webï¼‰
âŒ ä¸ç”¨ UnoCSSï¼ˆArco è‡ªå¸¦æ ·å¼ï¼‰
âŒ ä¸ç”¨ WebSocketï¼ˆå…ˆç”¨ HTTPï¼ŒåæœŸå¯åŠ ï¼‰
âŒ ä¸ç”¨å¤æ‚çš„ IPC æ¡¥æ¥
ğŸ¨ æ ¸å¿ƒåŠŸèƒ½è®¾è®¡
ä½ çš„åº”ç”¨ç›¸æ¯” AionUI çš„ç‹¬ç‰¹ä¹‹å¤„ï¼š
ç»Ÿä¸€å¯¹è¯ä¸Šä¸‹æ–‡: å¤šä¸ªè§’è‰²åœ¨åŒä¸€ä¸ªå¯¹è¯ä¸­ï¼Œå…±äº«å†å²è®°å½•
@æåŠåˆ‡æ¢è§’è‰²: ç”¨æˆ·å¯ä»¥ @Developer æˆ– @Designer åŠ¨æ€é€‰æ‹©
æ›´ç®€å•çš„æ¶æ„: ç›´æ¥è°ƒç”¨ AI APIï¼Œä¸éœ€è¦åŒ…è£… CLI å·¥å…·
ğŸ“‚ å®Œæ•´çš„æ–‡ä»¶ç»“æ„
è®¡åˆ’ä¸­åŒ…å«äº†æ¸…æ™°çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼Œæ¯ä¸ªæ–‡ä»¶çš„èŒè´£éƒ½å¾ˆæ˜ç¡®ã€‚
ğŸ’¡ å­¦ä¹ èµ„æº
æ¯ä¸ªé˜¶æ®µéƒ½æ ‡æ³¨äº†ï¼š
å­¦ä¹ é‡ç‚¹
å‚è€ƒ AionUI çš„å¯¹åº”æ–‡ä»¶è·¯å¾„
å¤–éƒ¨æ–‡æ¡£é“¾æ¥
ç°åœ¨ä½ å¯ä»¥ï¼š
æŸ¥çœ‹å®Œæ•´è®¡åˆ’: moonlit-noodling-puffin.md
å¦‚æœå¯¹æŸä¸ªé˜¶æ®µæœ‰ç–‘é—®ï¼Œéšæ—¶é—®æˆ‘
å‡†å¤‡å¥½åï¼Œæˆ‘å¯ä»¥é™ªä½ ä¸€èµ·å®ç°ç¬¬ä¸€é˜¶æ®µï¼ˆé¡¹ç›®æ­å»º + è®¤è¯ï¼‰
ä½ è§‰å¾—è¿™ä¸ªè®¡åˆ’æ€ä¹ˆæ ·ï¼Ÿéœ€è¦è°ƒæ•´å“ªäº›éƒ¨åˆ†å—ï¼Ÿ
Claudeâ€™s Plan
Multi-Agent Chat é¡¹ç›® - åˆ†æ­¥å®ç°è®¡åˆ’
é¡¹ç›®æ¦‚è¿°
æ„å»ºä¸€ä¸ªæ”¯æŒå¤šè§’è‰²å¯¹è¯çš„èŠå¤©åº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ @æåŠ ä¸åŒè§’è‰²ï¼ˆå¦‚ @Developerã€@Designerï¼‰ï¼Œæ¯ä¸ªè§’è‰²æœ‰ç‹¬ç«‹çš„ system promptï¼Œèƒ½çœ‹åˆ°å®Œæ•´çš„å¯¹è¯ä¸Šä¸‹æ–‡ã€‚ æŠ€æœ¯æ ˆ: React 19 + TypeScript + Express + SQLite + Arco Design ç­–ç•¥: å…ˆæ„å»º Web ç‰ˆæœ¬ï¼ˆæ›´ç®€å•ï¼‰ï¼Œä»£ç å¯å¤ç”¨ï¼ŒåæœŸå¯ä»¥ç”¨ Electron åŒ…è£…æˆæ¡Œé¢åº”ç”¨
é¡¹ç›®æ¶æ„

multi-agent-chat/
â”œâ”€â”€ server/                    # Express åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ database/         # SQLite æ•°æ®åº“å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts     # è¡¨å®šä¹‰ (users, conversations, messages, roles)
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts      # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”‚   â””â”€â”€ types.ts      # æ•°æ®ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ routes/           # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts       # ç™»å½•/æ³¨å†Œ
â”‚   â”‚   â”‚   â”œâ”€â”€ conversations.ts  # å¯¹è¯ CRUD
â”‚   â”‚   â”‚   â”œâ”€â”€ messages.ts   # æ¶ˆæ¯å†å²
â”‚   â”‚   â”‚   â”œâ”€â”€ roles.ts      # è§’è‰²ç®¡ç† CRUD
â”‚   â”‚   â”‚   â””â”€â”€ chat.ts       # å‘é€æ¶ˆæ¯åˆ° AI
â”‚   â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthService.ts    # JWT + å¯†ç åŠ å¯†
â”‚   â”‚   â”‚   â”œâ”€â”€ AIService.ts      # OpenAI API é›†æˆ
â”‚   â”‚   â”‚   â””â”€â”€ ContextBuilder.ts # ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts       # JWT éªŒè¯
â”‚   â”‚   â”‚   â””â”€â”€ errorHandler.ts
â”‚   â”‚   â””â”€â”€ index.ts          # Express å¯åŠ¨å…¥å£
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ client/                    # React å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx     # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ Chat.tsx      # ä¸»èŠå¤©ç•Œé¢
â”‚   â”‚   â”‚   â””â”€â”€ Settings.tsx  # è®¾ç½®ï¼ˆAPI keyã€è§’è‰²ç®¡ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageList.tsx      # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageInput.tsx     # è¾“å…¥æ¡†ï¼ˆæ”¯æŒ @æåŠï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ RoleSelector.tsx     # è§’è‰²é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationList.tsx # å¯¹è¯åˆ—è¡¨ï¼ˆä¾§è¾¹æ ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ RoleManager.tsx      # è§’è‰²ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx      # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ ConversationContext.tsx  # å½“å‰å¯¹è¯
â”‚   â”‚   â”‚   â””â”€â”€ RolesContext.tsx     # å¯ç”¨è§’è‰²åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts        # Axios å®ä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ authApi.ts    # è®¤è¯ API
â”‚   â”‚   â”‚   â”œâ”€â”€ chatApi.ts    # èŠå¤© API
â”‚   â”‚   â”‚   â””â”€â”€ rolesApi.ts   # è§’è‰² API
â”‚   â”‚   â”œâ”€â”€ types/            # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ mentionParser.ts  # è§£æ @æåŠ
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ main.tsx
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ README.md
æ•°æ®æ¨¡å‹
1. User (ç”¨æˆ·)

interface User {
  id: string;
  username: string;
  password_hash: string;
  created_at: number;
}
2. Role (è§’è‰²)

interface Role {
  id: string;
  user_id: string;
  name: string;              // "Developer", "Designer" ç­‰
  system_prompt: string;     // å®šä¹‰è§’è‰²çš„ç³»ç»Ÿæç¤ºè¯
  color: string;             // UI æ˜¾ç¤ºé¢œè‰²ï¼ˆå¦‚ "#3370ff"ï¼‰
  created_at: number;
}
3. Conversation (å¯¹è¯)

interface Conversation {
  id: string;
  user_id: string;
  name: string;              // å¯¹è¯æ ‡é¢˜
  created_at: number;
  updated_at: number;
}
4. Message (æ¶ˆæ¯)

interface Message {
  id: string;
  conversation_id: string;
  role_id?: string;          // NULL=ç”¨æˆ·æ¶ˆæ¯ï¼Œæœ‰å€¼=AI æ¶ˆæ¯
  content: string;           // æ¶ˆæ¯å†…å®¹
  position: 'left' | 'right'; // left=AI, right=ç”¨æˆ·
  created_at: number;
}
5. AIConfig (AI é…ç½®)

interface AIConfig {
  base_url: string;          // å¦‚ "https://api.openai.com/v1"
  api_key: string;           // API å¯†é’¥
  model: string;             // æ¨¡å‹åç§°ï¼ˆå¦‚ "gpt-4"ï¼‰
  max_context_messages: number;  // ä¸Šä¸‹æ–‡æ¶ˆæ¯æ•°é‡é™åˆ¶
}
åˆ†é˜¶æ®µå®ç°æ­¥éª¤
ç¬¬ä¸€é˜¶æ®µï¼šé¡¹ç›®æ­å»º + è®¤è¯ç³»ç»Ÿï¼ˆå­¦ä¹ ï¼šNode.js + Express + JWTï¼‰
ç›®æ ‡: æ­å»ºåŸºç¡€æ¶æ„ï¼Œå®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½ åç«¯ä»»åŠ¡:
åˆå§‹åŒ– TypeScript + Express é¡¹ç›®
å®‰è£…ä¾èµ–: express, better-sqlite3, bcrypt, jsonwebtoken, cors, dotenv
åˆ›å»ºæ•°æ®åº“ schemaï¼ˆusers è¡¨ï¼‰
å®ç° AuthServiceï¼ˆå¯†ç åŠ å¯†ã€JWT ç”Ÿæˆï¼‰
åˆ›å»º auth è·¯ç”±: POST /api/auth/register, POST /api/auth/login
æ·»åŠ  JWT ä¸­é—´ä»¶éªŒè¯
å‰ç«¯ä»»åŠ¡:
ä½¿ç”¨ Vite åˆ›å»º React + TypeScript é¡¹ç›®
å®‰è£…ä¾èµ–: @arco-design/web-react, axios, react-router-dom
åˆ›å»º Login.tsx ç™»å½•é¡µé¢ï¼ˆä½¿ç”¨ Arco Design çš„ Form ç»„ä»¶ï¼‰
å®ç° AuthContextï¼ˆç®¡ç†ç™»å½•çŠ¶æ€ã€JWT tokenï¼‰
é…ç½® React Routerï¼ˆ/login, /chat è·¯ç”±ï¼‰
åˆ›å»º api.ts axios å®ä¾‹ï¼ˆè‡ªåŠ¨é™„åŠ  JWT tokenï¼‰
å­¦ä¹ é‡ç‚¹:
Express è·¯ç”±å’Œä¸­é—´ä»¶
SQLite æ•°æ®åº“æ“ä½œ
JWT è®¤è¯åŸç†
React Context API
TypeScript åŸºç¡€ç±»å‹
å‚è€ƒ AionUI æ–‡ä»¶:
src/webserver/auth/ - è®¤è¯å®ç°
src/renderer/context/AuthContext.tsx - å‰ç«¯è®¤è¯çŠ¶æ€ç®¡ç†
ç¬¬äºŒé˜¶æ®µï¼šè§’è‰²ç³»ç»Ÿï¼ˆå­¦ä¹ ï¼šCRUD æ“ä½œ + è¡¨å•å¤„ç†ï¼‰
ç›®æ ‡: åˆ›å»ºå’Œç®¡ç†ä¸åŒçš„å¯¹è¯è§’è‰² åç«¯ä»»åŠ¡:
åœ¨ schema.ts ä¸­æ·»åŠ  roles è¡¨
åˆ›å»º RoleServiceï¼ˆCRUD ä¸šåŠ¡é€»è¾‘ï¼‰
åˆ›å»º roles è·¯ç”±:
GET /api/roles - è·å–è§’è‰²åˆ—è¡¨
POST /api/roles - åˆ›å»ºæ–°è§’è‰²
PUT /api/roles/:id - æ›´æ–°è§’è‰²
DELETE /api/roles/:id - åˆ é™¤è§’è‰²
åˆå§‹åŒ– 3 ä¸ªé»˜è®¤è§’è‰²:
Developer: "ä½ æ˜¯ä¸€ä¸ªèµ„æ·±è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆ..."
Designer: "ä½ æ˜¯ä¸€ä¸ª UX/UI è®¾è®¡å¸ˆ..."
Product Manager: "ä½ æ˜¯ä¸€ä¸ªäº§å“ç»ç†..."
å‰ç«¯ä»»åŠ¡:
åˆ›å»º RolesContextï¼ˆç®¡ç†è§’è‰²åˆ—è¡¨çŠ¶æ€ï¼‰
åˆ›å»º Settings.tsx é¡µé¢
å®ç° RoleManager.tsx ç»„ä»¶:
æ˜¾ç¤ºè§’è‰²åˆ—è¡¨ï¼ˆTable ç»„ä»¶ï¼‰
åˆ›å»º/ç¼–è¾‘è§’è‰²çš„ Modalï¼ˆè¡¨å•ï¼šåç§°ã€ç³»ç»Ÿæç¤ºè¯ã€é¢œè‰²é€‰æ‹©å™¨ï¼‰
åˆ é™¤è§’è‰²ç¡®è®¤
åˆ›å»º rolesApi.ts æœåŠ¡ï¼ˆAPI è°ƒç”¨å‡½æ•°ï¼‰
å­¦ä¹ é‡ç‚¹:
RESTful API è®¾è®¡
SQL å¤–é”®å…³ç³»
React è¡¨å•å¤„ç†ï¼ˆå—æ§ç»„ä»¶ï¼‰
Arco Design Tableã€Modalã€Form ç»„ä»¶
çŠ¶æ€ç®¡ç†ï¼ˆContext æ¨¡å¼ï¼‰
å‚è€ƒ AionUI æ–‡ä»¶:
src/process/database/schema.ts - æ•°æ®åº“è¡¨è®¾è®¡
src/renderer/pages/settings/ - è®¾ç½®é¡µé¢ç»“æ„
ç¬¬ä¸‰é˜¶æ®µï¼šåŸºç¡€èŠå¤©åŠŸèƒ½ï¼ˆå­¦ä¹ ï¼šå¯¹è¯ç®¡ç† + æ¶ˆæ¯æ¸²æŸ“ï¼‰
ç›®æ ‡: å®ç°å¯¹è¯åˆ›å»ºã€æ¶ˆæ¯å‘é€å’Œæ˜¾ç¤ºï¼ˆæš‚ä¸æ¥å…¥ AIï¼‰ åç«¯ä»»åŠ¡:
åœ¨ schema.ts ä¸­æ·»åŠ  conversations å’Œ messages è¡¨
åˆ›å»º conversations è·¯ç”±:
GET /api/conversations - è·å–å¯¹è¯åˆ—è¡¨
POST /api/conversations - åˆ›å»ºæ–°å¯¹è¯
DELETE /api/conversations/:id - åˆ é™¤å¯¹è¯
åˆ›å»º messages è·¯ç”±:
GET /api/conversations/:id/messages - è·å–æ¶ˆæ¯å†å²
POST /api/conversations/:id/messages - æ·»åŠ ç”¨æˆ·æ¶ˆæ¯ï¼ˆä»…ä¿å­˜ï¼Œä¸è°ƒç”¨ AIï¼‰
å‰ç«¯ä»»åŠ¡:
åˆ›å»º ConversationContextï¼ˆå½“å‰å¯¹è¯ IDã€æ¶ˆæ¯åˆ—è¡¨ï¼‰
åˆ›å»º Chat.tsx ä¸»é¡µé¢ï¼ˆå¸ƒå±€ï¼šä¾§è¾¹æ  + èŠå¤©åŒºï¼‰
å®ç° ConversationList.tsxï¼ˆæ˜¾ç¤ºå¯¹è¯åˆ—è¡¨ï¼Œç‚¹å‡»åˆ‡æ¢ï¼‰
å®ç° MessageList.tsxï¼ˆæ˜¾ç¤ºæ¶ˆæ¯ï¼ŒåŒºåˆ†ç”¨æˆ·/AIï¼Œæ”¯æŒ Markdownï¼‰
å®ç° MessageInput.tsxï¼ˆæ–‡æœ¬è¾“å…¥æ¡† + å‘é€æŒ‰é’®ï¼‰
é›†æˆ react-markdown æ˜¾ç¤ºå¯Œæ–‡æœ¬æ¶ˆæ¯
å­¦ä¹ é‡ç‚¹:
å¯¹è¯å’Œæ¶ˆæ¯çš„æ•°æ®æ¨¡å‹
åˆ—è¡¨æ¸²æŸ“å’Œæ¡ä»¶æ¸²æŸ“
ç»„ä»¶é—´é€šä¿¡ï¼ˆé€šè¿‡ Contextï¼‰
Markdown æ¸²æŸ“
æ—¶é—´æ ¼å¼åŒ–
å‚è€ƒ AionUI æ–‡ä»¶:
src/renderer/context/ConversationContext.tsx
src/renderer/pages/conversation/ChatConversation.tsx
src/renderer/components/Markdown.tsx
ç¬¬å››é˜¶æ®µï¼šAI é›†æˆï¼ˆå­¦ä¹ ï¼šå¤–éƒ¨ API è°ƒç”¨ + å¼‚æ­¥å¤„ç†ï¼‰
ç›®æ ‡: æ¥å…¥ OpenAI å…¼å®¹çš„ APIï¼Œå®ç°çœŸæ­£çš„ AI å¯¹è¯ åç«¯ä»»åŠ¡:
åˆ›å»º AIService.ts:

async chat(
  systemPrompt: string,
  contextMessages: Message[],
  userMessage: string
): Promise<string>
åœ¨ schema.ts æ·»åŠ  ai_config è¡¨ï¼ˆå­˜å‚¨ base_url, api_key, modelï¼‰
åˆ›å»º chat è·¯ç”±:
POST /api/chat
è¯·æ±‚ä½“: { conversationId, roleId, message }
æµç¨‹:
ä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ°æ•°æ®åº“
è·å–è§’è‰²çš„ system_prompt
è·å–å¯¹è¯å†å²ï¼ˆæœ€è¿‘ N æ¡æ¶ˆæ¯ï¼‰
è°ƒç”¨ AIService.chat()
ä¿å­˜ AI å›å¤åˆ°æ•°æ®åº“
è¿”å› AI å›å¤
ä½¿ç”¨ axios è°ƒç”¨ OpenAI API: POST /v1/chat/completions
å‰ç«¯ä»»åŠ¡:
åœ¨ Settings.tsx æ·»åŠ  AI é…ç½®è¡¨å•:
API Base URLï¼ˆé»˜è®¤ https://api.openai.com/v1ï¼‰
API Key
Model åç§°
ä¿®æ”¹ MessageInput.tsx:
å‘é€æŒ‰é’®è§¦å‘ API è°ƒç”¨
æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼ˆSpin ç»„ä»¶ï¼‰
é”™è¯¯å¤„ç†ï¼ˆMessage æç¤ºï¼‰
æ›´æ–° ConversationContext æ·»åŠ  sendMessage æ–¹æ³•
MessageList è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
å­¦ä¹ é‡ç‚¹:
HTTP å®¢æˆ·ç«¯ï¼ˆaxiosï¼‰
ç¯å¢ƒå˜é‡å’Œé…ç½®ç®¡ç†
å¼‚æ­¥æ“ä½œå’Œ Promise
é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
OpenAI API è°ƒç”¨æ ¼å¼
å‚è€ƒ:
OpenAI API æ–‡æ¡£: https://platform.openai.com/docs/api-reference/chat
AionUI: src/process/bridge/geminiBridge.ts - AI è°ƒç”¨æ¨¡å¼
ç¬¬äº”é˜¶æ®µï¼š@æåŠç³»ç»Ÿï¼ˆå­¦ä¹ ï¼šæ–‡æœ¬è§£æ + åŠ¨æ€è§’è‰²åˆ‡æ¢ï¼‰
ç›®æ ‡: å®ç° @RoleName æåŠåŠŸèƒ½ï¼Œæ”¯æŒåœ¨åŒä¸€å¯¹è¯ä¸­åˆ‡æ¢è§’è‰² åç«¯ä»»åŠ¡:
ä¿®æ”¹ POST /api/chat è·¯ç”±:
ä»æ¶ˆæ¯ä¸­è§£æ @mentions
æå–æœ€åä¸€ä¸ª @æåŠçš„è§’è‰²
ä½¿ç”¨è¯¥è§’è‰²çš„ system_prompt
åœ¨ä¿å­˜æ¶ˆæ¯æ—¶è®°å½•ä½¿ç”¨çš„ role_id
å‰ç«¯ä»»åŠ¡:
åˆ›å»º mentionParser.ts å·¥å…·:

function parseMentions(text: string, roles: Role[]): {
  mentions: Role[],
  lastMention: Role | null
}
ä¿®æ”¹ MessageInput.tsx:
ç›‘å¬ "@" è¾“å…¥
æ˜¾ç¤ºè§’è‰²é€‰æ‹©ä¸‹æ‹‰æ¡†ï¼ˆAutoComplete ç»„ä»¶ï¼‰
æ”¯æŒé”®ç›˜å¯¼èˆªé€‰æ‹©è§’è‰²
é«˜äº®æ˜¾ç¤º @æåŠ
åœ¨ MessageList.tsx ä¸­æ˜¾ç¤ºè§’è‰²æ ‡è¯†:
æ¯æ¡ AI æ¶ˆæ¯æ˜¾ç¤ºè§’è‰²åç§°å’Œé¢œè‰²å¾½ç« 
ä½¿ç”¨è§’è‰²çš„ color å±æ€§
å­¦ä¹ é‡ç‚¹:
æ­£åˆ™è¡¨è¾¾å¼ï¼ˆè§£æ @mentionsï¼‰
å­—ç¬¦ä¸²å¤„ç†
è‡ªåŠ¨å®Œæˆç»„ä»¶
åŠ¨æ€æ ·å¼ï¼ˆæ ¹æ®è§’è‰²é¢œè‰²ï¼‰
UI ç¤ºä¾‹:

ç”¨æˆ·: @Developer å¦‚ä½•å®ç° React Context?
[Developer å›¾æ ‡] Developer: React Context æ˜¯ä¸€ç§...

ç”¨æˆ·: @Designer è¿™ä¸ªæŒ‰é’®ç”¨ä»€ä¹ˆé¢œè‰²å¥½?
[Designer å›¾æ ‡] Designer: å»ºè®®ä½¿ç”¨è“è‰²ä¸»é¢˜...
ç¬¬å…­é˜¶æ®µï¼šä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆå­¦ä¹ ï¼šæ€§èƒ½ä¼˜åŒ– + é«˜çº§åŠŸèƒ½ï¼‰
ç›®æ ‡: æ™ºèƒ½ç®¡ç†å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œç¡®ä¿ AI èƒ½çœ‹åˆ°å†å²æ¶ˆæ¯ åç«¯ä»»åŠ¡:
åˆ›å»º ContextBuilder.ts:

buildContext(conversationId: string, maxMessages: number): Message[]
ä¿®æ”¹ AIService.chat():
æ„å»ºå®Œæ•´çš„æ¶ˆæ¯æ•°ç»„:

[
  { role: 'system', content: systemPrompt },
  ...å†å²æ¶ˆæ¯,
  { role: 'user', content: newMessage }
]
åœ¨ ai_config æ·»åŠ  max_context_messages å­—æ®µ
å‰ç«¯ä»»åŠ¡:
åœ¨ Settings.tsx æ·»åŠ ä¸Šä¸‹æ–‡è®¾ç½®:
æ»‘å—é€‰æ‹©ä¸Šä¸‹æ–‡æ¶ˆæ¯æ•°é‡ï¼ˆ5-50ï¼‰
æ˜¾ç¤ºè¯´æ˜æ–‡å­—
ï¼ˆå¯é€‰ï¼‰æ˜¾ç¤º token è®¡æ•°:
å®‰è£… tiktoken åº“
æ˜¾ç¤ºæ¯æ¡æ¶ˆæ¯çš„å¤§çº¦ token æ•°
è­¦å‘Šæ¥è¿‘æ¨¡å‹é™åˆ¶æ—¶
å­¦ä¹ é‡ç‚¹:
ä¸Šä¸‹æ–‡çª—å£æ¦‚å¿µ
SQL åˆ†é¡µæŸ¥è¯¢ï¼ˆLIMIT, ORDER BYï¼‰
æ€§èƒ½ä¼˜åŒ–ï¼ˆé¿å…åŠ è½½è¿‡å¤šå†å²ï¼‰
Token è®¡æ•°åŸç†
å‚è€ƒ AionUI æ–‡ä»¶:
src/process/database/StreamingMessageBuffer.ts - æ¶ˆæ¯ç¼“å†²
ç¬¬ä¸ƒé˜¶æ®µï¼šUI ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†ï¼ˆå­¦ä¹ ï¼šç”¨æˆ·ä½“éªŒ + å¥å£®æ€§ï¼‰
ç›®æ ‡: å®Œå–„ç”¨æˆ·ç•Œé¢ï¼Œå¤„ç†è¾¹ç•Œæƒ…å†µ ä»»åŠ¡:
æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†ï¼ˆErrorBoundaryï¼‰
å®Œå–„åŠ è½½çŠ¶æ€ï¼ˆSkeleton ç»„ä»¶ï¼‰
ç©ºçŠ¶æ€æç¤ºï¼ˆEmpty ç»„ä»¶ï¼‰
å“åº”å¼å¸ƒå±€ï¼ˆæ”¯æŒç§»åŠ¨ç«¯ï¼‰
æ·±è‰²æ¨¡å¼åˆ‡æ¢ï¼ˆå‚è€ƒ AionUI ThemeContextï¼‰
æ¶ˆæ¯æ—¶é—´æˆ³æ˜¾ç¤º
å¯¹è¯é‡å‘½ååŠŸèƒ½
æ¶ˆæ¯æœç´¢åŠŸèƒ½
å¯¼å‡ºå¯¹è¯åŠŸèƒ½ï¼ˆJSON/Markdownï¼‰
å­¦ä¹ é‡ç‚¹:
é”™è¯¯è¾¹ç•Œï¼ˆReact Error Boundaryï¼‰
å“åº”å¼è®¾è®¡ï¼ˆCSS Media Queryï¼‰
ä¸»é¢˜åˆ‡æ¢å®ç°
ç”¨æˆ·ä½“éªŒä¼˜åŒ–
å‚è€ƒ AionUI æ–‡ä»¶:
src/renderer/context/ThemeContext.tsx
src/renderer/components/base/ - åŸºç¡€ç»„ä»¶
ç¬¬å…«é˜¶æ®µï¼ˆå¯é€‰ï¼‰ï¼šé«˜çº§ç‰¹æ€§
æµå¼å“åº”:
åç«¯ï¼šä½¿ç”¨ Server-Sent Events (SSE) æˆ– WebSocket
å‰ç«¯ï¼šå®æ—¶æ˜¾ç¤º AI ç”Ÿæˆçš„æ–‡æœ¬
å‚è€ƒï¼šAionUI çš„ WebSocket å®ç°
æ¶ˆæ¯ç¼–è¾‘:
ç¼–è¾‘å·²å‘é€çš„æ¶ˆæ¯
é‡æ–°ç”Ÿæˆ AI å›å¤
å¤šè½®å¯¹è¯åˆ†æ”¯:
ä»å†å²æŸæ¡æ¶ˆæ¯é‡æ–°å¼€å§‹å¯¹è¯
æ ‘çŠ¶å¯¹è¯ç»“æ„
æ–‡ä»¶ä¸Šä¼ :
ä¸Šä¼ å›¾ç‰‡ã€æ–‡æ¡£
AI åˆ†ææ–‡ä»¶å†…å®¹
å¤šè¯­è¨€æ”¯æŒ:
i18next å›½é™…åŒ–
ä¸­æ–‡/è‹±æ–‡åˆ‡æ¢
æ ¸å¿ƒæŠ€æœ¯ç‚¹è¯¦è§£
1. @æåŠè§£ææµç¨‹

// å‰ç«¯: utils/mentionParser.ts
function parseMentions(text: string, roles: Role[]) {
  const mentionRegex = /@(\w+)/g;
  const matches = [...text.matchAll(mentionRegex)];

  const foundRoles = matches
    .map(m => roles.find(r =>
      r.name.toLowerCase() === m[1].toLowerCase()
    ))
    .filter(Boolean);

  return {
    mentions: foundRoles,
    lastMention: foundRoles[foundRoles.length - 1] || null
  };
}

// ä½¿ç”¨ç¤ºä¾‹
const text = "@Developer å¸®æˆ‘å®ç°ç™»å½•åŠŸèƒ½";
const { lastMention } = parseMentions(text, availableRoles);
// lastMention.system_prompt = "ä½ æ˜¯ä¸€ä¸ªèµ„æ·±è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆ..."
2. AI API è°ƒç”¨ç»“æ„

// åç«¯: services/AIService.ts
async chat(systemPrompt: string, context: Message[], userMsg: string) {
  const messages = [
    { role: 'system', content: systemPrompt },
    ...context.map(m => ({
      role: m.position === 'right' ? 'user' : 'assistant',
      content: m.content
    })),
    { role: 'user', content: userMsg }
  ];

  const response = await axios.post(
    `${this.config.base_url}/chat/completions`,
    { model: this.config.model, messages },
    { headers: { 'Authorization': `Bearer ${this.config.api_key}` }}
  );

  return response.data.choices[0].message.content;
}
3. ä¸Šä¸‹æ–‡æ„å»ºç­–ç•¥

// åç«¯: services/ContextBuilder.ts
buildContext(conversationId: string, maxMessages: number = 10) {
  // è·å–æœ€è¿‘çš„ N æ¡æ¶ˆæ¯ï¼ˆé™åºï¼‰
  const messages = db.prepare(`
    SELECT * FROM messages
    WHERE conversation_id = ?
    ORDER BY created_at DESC
    LIMIT ?
  `).all(conversationId, maxMessages);

  // åè½¬ä¸ºæ—¶é—´æ­£åº
  return messages.reverse();
}
å…³é”®æ–‡ä»¶åˆ—è¡¨
åç«¯æ ¸å¿ƒæ–‡ä»¶
server/src/index.ts - Express æœåŠ¡å™¨å…¥å£
server/src/database/schema.ts - æ•°æ®åº“è¡¨å®šä¹‰
server/src/services/AIService.ts - AI API é›†æˆ
server/src/routes/chat.ts - èŠå¤©è·¯ç”±ï¼ˆæœ€æ ¸å¿ƒï¼‰
server/src/middleware/auth.ts - JWT è®¤è¯ä¸­é—´ä»¶
å‰ç«¯æ ¸å¿ƒæ–‡ä»¶
client/src/pages/Chat.tsx - ä¸»èŠå¤©é¡µé¢
client/src/components/MessageInput.tsx - è¾“å…¥æ¡†ï¼ˆ@æåŠï¼‰
client/src/components/MessageList.tsx - æ¶ˆæ¯åˆ—è¡¨
client/src/contexts/ConversationContext.tsx - å¯¹è¯çŠ¶æ€ç®¡ç†
client/src/utils/mentionParser.ts - @æåŠè§£æå™¨
å­¦ä¹ èµ„æº
TypeScript åŸºç¡€:
å®˜æ–¹æ–‡æ¡£: https://www.typescriptlang.org/docs/
é‡ç‚¹å­¦ä¹ : æ¥å£ã€ç±»å‹ã€æ³›å‹
React 19:
å®˜æ–¹æ–‡æ¡£: https://react.dev/
é‡ç‚¹å­¦ä¹ : Hooks (useState, useEffect, useContext), Context API
Express.js:
å®˜æ–¹æ–‡æ¡£: https://expressjs.com/
é‡ç‚¹å­¦ä¹ : è·¯ç”±ã€ä¸­é—´ä»¶ã€é”™è¯¯å¤„ç†
SQLite:
better-sqlite3 æ–‡æ¡£: https://github.com/WiseLibs/better-sqlite3
é‡ç‚¹å­¦ä¹ : CRUD æ“ä½œã€å¤–é”®å…³ç³»
Arco Design:
å®˜æ–¹æ–‡æ¡£: https://arco.design/react/docs/start
é‡ç‚¹å­¦ä¹ : Form, Table, Modal, Message ç»„ä»¶
OpenAI API:
å®˜æ–¹æ–‡æ¡£: https://platform.openai.com/docs/api-reference/chat
é‡ç‚¹å­¦ä¹ : Chat Completions API æ ¼å¼
AionUI å‚è€ƒå¯¹ç…§
ä½ çš„åº”ç”¨	AionUI å¯¹åº”éƒ¨åˆ†	è¯´æ˜
Role ç³»ç»Ÿ	ä¸åŒçš„ Agent ç±»å‹ (gemini, acp, codex)	ä½ çš„æ›´ç®€å•ï¼Œç›´æ¥åˆ‡æ¢ system prompt
@æåŠè§£æ	-	æ–°åŠŸèƒ½ï¼ŒAionUI æ²¡æœ‰
ç»Ÿä¸€å¯¹è¯ä¸Šä¸‹æ–‡	æ¯ä¸ª Agent ç‹¬ç«‹ä¼šè¯	ä½ çš„è®¾è®¡å…è®¸å¤šè§’è‰²å…±äº«ä¸Šä¸‹æ–‡
Web ä¼˜å…ˆ	Electron ä¼˜å…ˆ	ä½ ä»ç®€å•å¼€å§‹ï¼Œåç»­å¯æ·»åŠ  Electron
ç›´æ¥ API è°ƒç”¨	åŒ…è£… CLI å·¥å…·	ä½ çš„æ¶æ„æ›´ç®€å•
å‚è€ƒ AionUI å­¦ä¹ :
æ•°æ®åº“è®¾è®¡: src/process/database/schema.ts
è®¤è¯ç³»ç»Ÿ: src/webserver/auth/
å¯¹è¯çŠ¶æ€ç®¡ç†: src/renderer/context/ConversationContext.tsx
æ¶ˆæ¯æ˜¾ç¤º: src/renderer/pages/conversation/
è®¾ç½®é¡µé¢: src/renderer/pages/settings/
é¡¹ç›®æ—¶é—´çº¿ï¼ˆå‚è€ƒï¼‰
ç¬¬ 1 å‘¨: é¡¹ç›®æ­å»º + è®¤è¯ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰
ç¬¬ 2 å‘¨: è§’è‰²ç³»ç»Ÿï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
ç¬¬ 3 å‘¨: åŸºç¡€èŠå¤©ï¼ˆç¬¬ä¸‰é˜¶æ®µï¼‰
ç¬¬ 4 å‘¨: AI é›†æˆï¼ˆç¬¬å››é˜¶æ®µï¼‰
ç¬¬ 5 å‘¨: @æåŠç³»ç»Ÿï¼ˆç¬¬äº”é˜¶æ®µï¼‰
ç¬¬ 6 å‘¨: ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆç¬¬å…­é˜¶æ®µï¼‰
ç¬¬ 7 å‘¨: UI ä¼˜åŒ–ï¼ˆç¬¬ä¸ƒé˜¶æ®µï¼‰
ç¬¬ 8 å‘¨+: å¯é€‰é«˜çº§åŠŸèƒ½ï¼ˆç¬¬å…«é˜¶æ®µï¼‰
åç»­æ‰©å±•ï¼šElectron æ¡Œé¢ç‰ˆ
å½“ Web ç‰ˆæœ¬å®Œæˆåï¼Œå¯ä»¥æ·»åŠ  Electron åŒ…è£…ï¼š
å®‰è£… Electron Forgeï¼ˆå’Œ AionUI ç›¸åŒï¼‰
åˆ›å»º src/main.ts ä¸»è¿›ç¨‹
åˆ›å»º src/preload.ts é¢„åŠ è½½è„šæœ¬
åœ¨ä¸»è¿›ç¨‹ä¸­å¯åŠ¨ Express æœåŠ¡å™¨
BrowserWindow åŠ è½½å‰ç«¯é¡µé¢
æ·»åŠ  IPC é€šä¿¡ï¼ˆæ–‡ä»¶ç³»ç»Ÿæ“ä½œç­‰ï¼‰
æ‰“åŒ…åˆ†å‘
å‚è€ƒ:
AionUi/src/index.ts - Electron ä¸»è¿›ç¨‹
AionUi/src/preload.ts - IPC æ¡¥æ¥
AionUi/forge.config.ts - æ‰“åŒ…é…ç½®
